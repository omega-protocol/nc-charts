{{- if .Values.manifests.service_metrics }}
---
apiVersion: v1
kind: Service
metadata:
  name: tekton-triggers-controller
spec:
  selector:
    release_group: {{ $.Values.release_group | default $.Release.Name }}
    application: "tekton-triggers"
    component: "controller"
  {{- if $.Values.network.node_port.enabled }}
  type: NodePort
  {{- if $.Values.network.external_policy_local }}
  externalTrafficPolicy: Local
  {{- end }}
  {{- end }}
  ports:
  - name: http-metrics
    protocol: TCP
    port: {{ tuple "tekton-triggers" "internal" "metrics" $ | include "tekton.port_lookup" }}
    targetPort:  {{ tuple "tekton-triggers" "target" "metrics" $ | include "tekton.port_lookup" }}
    {{- if $.Values.network.node_port.enabled }}
    nodePort: {{ $.Values.network.node_port.port }}
    {{- end }}
{{- end }}
